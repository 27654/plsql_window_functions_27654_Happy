Ranking Functions: Top N customers by revenue

SELECT c.CUSTOMERNAME, SUM(t.QUANTITY * p.PRICE) AS TOTAL_REVENUE,
       RANK() OVER (ORDER BY SUM(t.QUANTITY * p.PRICE) DESC) AS RANKING
FROM TRANSACTIONS t
JOIN CUSTOMERS c ON t.CUSTOMERID = c.CUSTOMERID
JOIN PRODUCTS p ON t.PRODUCTID = p.PRODUCTID
GROUP BY c.CUSTOMERNAME
ORDER BY TOTAL_REVENUE DESC;

Aggregate Window Functions: Running total

SELECT t.TRANSACTIONID, c.CUSTOMERNAME, t.TRANSACTIONDATE,
       SUM(t.QUANTITY * p.PRICE) OVER (ORDER BY t.TRANSACTIONDATE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS RUNNING_TOTAL
FROM TRANSACTIONS t
JOIN CUSTOMERS c ON t.CUSTOMERID = c.CUSTOMERID
JOIN PRODUCTS p ON t.PRODUCTID = p.PRODUCTID;

Navigation Functions: Period-to-period revenue comparison

SELECT t.TRANSACTIONID, c.CUSTOMERNAME, t.TRANSACTIONDATE,
       (t.QUANTITY * p.PRICE) AS REVENUE,
       LAG(t.QUANTITY * p.PRICE) OVER (ORDER BY t.TRANSACTIONDATE) AS PREVIOUS_REVENUE
FROM TRANSACTIONS t
JOIN CUSTOMERS c ON t.CUSTOMERID = c.CUSTOMERID
JOIN PRODUCTS p ON t.PRODUCTID = p.PRODUCTID;

Distribution Functions: Customer segmentation

SELECT c.CUSTOMERNAME, SUM(t.QUANTITY * p.PRICE) AS TOTAL_REVENUE,
       NTILE(4) OVER (ORDER BY SUM(t.QUANTITY * p.PRICE) DESC) AS QUARTILE
FROM TRANSACTIONS t
JOIN CUSTOMERS c ON t.CUSTOMERID = c.CUSTOMERID
JOIN PRODUCTS p ON t.PRODUCTID = p.PRODUCTID
GROUP BY c.CUSTOMERNAME;


